---
title: 'EST--24107: Tarea 3'
runningheader: 'Tarea 3'
author: |
  Carlos Lezama, Marco Medina, \
  Emiliano Ramírez y Santiago Villarreal
date: 'Lunes, 4 de octubre de 2021'
output:
    tufte::tufte_handout:
    citation_package: natbib
latex_engine: xelatex
link-citations: yes
---

```{r setup, include=FALSE}
library(tufte)
library(tidyverse)
library(copula)

knitr::opts_chunk$set(
  cache.extra = packageVersion('tufte'),
  cache = TRUE,
  fig.pos = '!h',
  out.extra = ''
)
options(htmltools.dir.version = FALSE)
```

# Problema 1

\newpage

# Problema 2

\newpage

# Problema 3

\newpage

# Problema 4

Probar que la cópula de Clayton converge a la cópula de comonoticidad cuando $\theta \to \infty$.

Notemos que la cópula de Clayton la podemos escribir como:

$$\exp[\ln(u_{1}^{-\theta} + u_{2}^{-\theta} - 1)/\theta]$$

Calculamos entonces el límite cuando $\theta \to \infty$ aplicando la regla de L'Hôpital:

$$\lim_{\theta\to\infty} \ln(u_{1}^{-\theta} + u_{2}^{-\theta} - 1)/\theta = \lim_{\theta\to\infty} \frac{1}{u_{1}^{-\theta} + u_{2}^{-\theta} - 1}\cdot[-u_{1}^{-\theta}\ln{u_{1}} + -u_{2}^{-\theta}\ln{u_{2}}] = \lim_{\theta\to\infty} -\frac{\sum_{i}u_{i}^{-\theta}\ln{u_{i}}}{\sum_{i}u_{i}^{-\theta} -1}$$

Sea $u_{m} = \min\{u_{1},u_{2}\}$, suponemos que $u_{m}\neq 0$. Dividimos y multiplicamos por $u_{m}^{\theta}$.

$$\implies \lim_{\theta\to\infty} -\frac{\sum_{i}u_{i}^{-\theta}\ln{u_{i}}}{\sum_{i}u_{i}^{-\theta} -1} = \lim_{\theta\to\infty} -\frac{\sum_{i}(u_{m}/u_{i})^{\theta}\ln{u_{i}}}{\sum_{i}(u_{m}/u_{i})^{\theta} -1}$$

Notemos que si $u_{i} \neq u_{m}$, entonces $u_{m}/u_{i} < 1$, por lo que $\lim_{\theta\to\infty} (u_{m}/u_{i})^{\theta} = 0$. Si $u_{i} = u_{m}$, entonces $u_{m}/u_{i} = 1$ y $\lim_{\theta\to\infty} (u_{m}/u_{i})^{\theta} = 1$. 

$$\implies \lim_{\theta\to\infty} -\frac{\sum_{i}(u_{m}/u_{i})^{\theta}\ln{u_{i}}}{\sum_{i}(u_{m}/u_{i})^{\theta} -1} = -\frac{\ln{u_{m}}}{-1} = \ln{u_{m}}$$

Por lo que si tomamos el límite completo:

$$ \lim_{\theta\to\infty} \exp\{\ln(u_{1}^{-\theta} + u_{2}^{-\theta} - 1)/\theta\} = \exp{\{\lim_{\theta\to\infty} \ln(u_{1}^{-\theta} + u_{2}^{-\theta} - 1)/\theta\ \}} = \exp{\{ \ln{u_{m}} \}} = u_{m}$$

Supongamos ahora que $u_{m} = 0$, en ese caso:

$$ \lim_{\theta\to\infty} [u_{1}^{-\theta} + u_{2}^{-\theta} - 1]^\frac{1}{\theta} = 0$$

Por lo tanto, la cópula de Clayton converge a la cópula de comonoticidad cuando $\theta \to \infty$.

\newpage

# Problema 5

\newpage

# Problema 6

#### Mostrar que la densidad conjunta correspondiente a la cópula Farlie-Gumbel-Morgenstern es no negativa.

\

Sea la densidad conjunta correspondiente a la cópula Farlie-Gumbel-Morgenstern:

$$\frac{\partial^{2}}{\partial u v} C(u,v) =  [1+\alpha(1-u)(1-v)] -\alpha v(1-u)-\alpha u(1-v) + \alpha u v$$

$$\implies \frac{\partial^{2}}{\partial u v} C(u,v) =  1 + \alpha(2u-1)(2v-1)$$
Basta con probar que $(2u-1)(2v-1) \geq -1$ para probar que $\frac{\partial^{2}}{\partial u v} C(u,v) \geq 0$. 

$$(2u-1)(2v-1) \geq -1 \iff \left[(2u-1)\geq\frac{-1}{(2v-1)} \land (2v-1) > 0 \right] \lor \left[(2u-1)\leq\frac{-1}{(2v-1)} \land (2v-1) < 0 \right] $$

Notemos que como $u$ y $v$ están entre 0 y 1. En el primer caso, la mayor cota inferior posible para $2u-1$ es cuando $v = 1$, entonces:

$$ (2u-1) \geq -1 \geq \frac{-1}{(2v-1)} $$

En el segundo caso, la menor cota superior posible para $2u-1$ es cuando $v = 0$, entonces:

$$(2u-1)\leq 0 \leq \frac{-1}{(2v-1)}$$

Por lo tanto $u$ cumple la desigualdad para todo valor de $v$. De manera análoga, por simetría, $v$ cumple la desigualdad para todo valor de $u$. Por lo tanto $(2u-1)(2v-1) \geq -1$ y $\frac{\partial^{2}}{\partial u v} C(u,v) \geq 0$.

#### Calcular el coeficiente de correlación de Spearman

\

Sabemos que si tenemos $C(u,v)$, entonces podemos calcular el coeficiente de correlación de Spearman como:

$$\rho = 12 \int_{0}^{1}\int_{0}^{1}C(u,v)dudv - 3 = 12 \int_{0}^{1}\int_{0}^{1}uvdC(u,v) - 3 = 3 - 6 \int_{0}^{1}\int_{0}^{1} \left(u \frac{\partial}{\partial u} C(u,v) +  v \frac{\partial}{\partial v} C(u,v)\right)dudv$$

$$\implies \rho = 3 - 6 \int_{0}^{1}\int_{0}^{1} uv+\alpha u(1-u)(1-v) - \alpha u^{2}v(1-v) + uv + \alpha(1-u)v(1-v) - \alpha u(1-u)v^{2} du dv$$

$$\implies \rho = 3 - 6 \int_{0}^{1} \frac{1}{2}v+  \frac{1}{6}\alpha (1-v) - \frac{1}{3} \alpha v(1-v) +  \frac{1}{2} v +  \frac{1}{2} \alpha v(1-v) -  \frac{1}{6}\alpha v^{2} dv$$


$$\implies \rho = 3 - 6 \left[\frac{1}{2}\cdot\frac{1}{2}+  \frac{1}{6}\cdot\frac{1}{2}\alpha - \frac{1}{3}\cdot\frac{1}{6} \alpha +  \frac{1}{2}\cdot\frac{1}{2} +  \frac{1}{2}\cdot\frac{1}{6} \alpha -  \frac{1}{6}\cdot\frac{1}{3}\alpha \right] = 3 - 6\left[\frac{1}{2} + \frac{1}{18} \alpha \right]$$

$$\therefore \rho = \frac{\alpha}{3}$$
Es decir, el coeficiente de correlación de Spearman de la cópula es función del parámetro $\alpha$, tal que $\rho(\alpha) \in (-\frac{1}{3},\frac{1}{3})$.

#### Calcular la tau de Kendall

\

Sabemos que si tenemos $C(u,v)$, entonces podemos calcular la tau de Kendall:

$$\tau = 4 \int_{0}^{1}\int_{0}^{1}C(u,v)dC(u,v) -1 = 1 - 4 \int_{0}^{1}\int_{0}^{1} \left(\frac{\partial}{\partial u} C(u,v) \cdot \frac{\partial}{\partial v} C(u,v)\right)dudv$$

$$\implies \tau = 1 - 4 \int_{0}^{1}\int_{0}^{1} uv + \alpha u(1-u)v(1-v) - \alpha u(1-u)v^{2} -\alpha u^{2}v(1-v)+ \alpha u(1-u)v(1-v) $$

$$ + \alpha^{2} u(1-u)^{2}v(1-v)^{2} - \alpha^{2}u(1-u)^{2} -\alpha^{2}u^{2}(1-u)v(1-v) + \alpha^{2}u^{2}(1-u)v^{2}(1-v)  dudv$$

OJO: notemos que los cuatro términos que incluyen a $\alpha^{2}$ se cancelan tras la integración.

$$\implies \tau = 1 - 4 \int_{0}^{1}\int_{0}^{1} uv + \alpha u(1-u)v(1-v) - \alpha u(1-u)v^{2} -\alpha u^{2}v(1-v)+ \alpha u(1-u)v(1-v) dudv$$
$$\implies \tau = 1 - 4 \int_{0}^{1} \frac{1}{2}v + \frac{1}{6}\alpha v(1-v) - \frac{1}{6}\alpha v^{2} -\frac{1}{3}\alpha v(1-v)+ \frac{1}{6}\alpha v(1-v) dv$$

$$\implies \tau = 1 - 4 \left[\frac{1}{2}\cdot\frac{1}{2} + \frac{1}{6}\cdot\frac{1}{6}\alpha - \frac{1}{6}\cdot\frac{1}{3}\alpha -\frac{1}{3}\cdot\frac{1}{6}\alpha + \frac{1}{6}\cdot\frac{1}{6}\alpha \right] = 1 -4 \left[\frac{1}{4} - \frac{1}{18}\alpha \right] = \frac{2}{9}\alpha$$

$$\therefore \tau = \frac{2}{9}\alpha$$

Es decir, la tau de Kendall de la cópula es función del parámetro $\alpha$, tal que $\tau(\alpha) \in (-\frac{2}{9},\frac{2}{9})$.

\newpage

# Problema 7

Sabemos $\tau = 0.2$.

1. Cópula normal (o cualquier elíptica): $\displaystyle \rho = \sin \left( \frac{\pi}{2}  \tau \right) =$ `r sin(pi * 0.2 / 2)`.
2. Cópula de Gumbel: $\displaystyle \alpha = \frac{1}{1 - \tau} =$ `r 1 / (1 - 0.2)`.
3. Cópula de Clayton: $\displaystyle \alpha = \frac{2 \tau}{1 - \tau} =$ `r (2 * 0.2) / (1 - 0.2)`.

\newpage

# Problema 8

Generación de cópulas:

```{r message=FALSE}
normCopula0.9 <- normalCopula(param = 0.9, dim = 2)
normCopula0.2 <- normalCopula(param = 0.2, dim = 2)
```

Visualización:

```{r out.width="75%", fig.width = 8, fig.height = 8, cache=TRUE, warning=FALSE, message=FALSE, echo=FALSE}
contour(normCopula0.9,
        pCopula,
        main = "CDF contour 0.9")
persp(normCopula0.9,
      pCopula,
      main = "CDF 0.9")
contour(normCopula0.9,
        dCopula,
        main = "Density contour 0.9")
persp(normCopula0.9,
      dCopula,
      main = "Density 0.9")

contour(normCopula0.2,
        pCopula,
        main = "CDF contour 0.2")
persp(normCopula0.2,
      pCopula,
      main = "CDF 0.2")
contour(normCopula0.2,
        dCopula,
        main = "Density contour 0.2")
persp(normCopula0.2,
      dCopula,
      main = "Density 0.2")
```

Nótese que con mayor coeficiente de correlación, más nos aproximamos a una relación lineal --- fácil de observar en las curvas de nivel de la función de probabilidad acumulada. Así pues, la dependencia lineal en la cópula gaussiana está directamente relacionada con su parámetro.

\newpage

# Problema 9

Simulamos 500 puntos cuya distribución son las cópulas del ejercicio 8 anterior.

```{r rcop09, out.width="75%", fig.width = 6, fig.height = 6, echo  = FALSE}
normCopula0_9 <- normalCopula(param = 0.9, dim = 2)
rcop09<- rCopula(500, normCopula0_9)
pairs(rcop09, main = "Parámetro 0.9")
```

\

```{r rcop02, out.width="75%", fig.width = 6, fig.height = 6, echo = FALSE}
normCopula0_2 <- normalCopula(param = 0.2, dim = 2)
rcop02<- rCopula(500, normCopula0_2)
pairs(rcop02, main = "Parámetro 0.2")
```

Como podemos observar, existe una mayor dependencia entre las marginales cuando el parámetro de normalCopula es 0.9 que cuando es 0.2.


\newpage

\bibliography{}
