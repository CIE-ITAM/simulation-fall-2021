---
title: "EST--24107: Tarea 1"
runningheader: "Tarea 1 -- Equipo C"
author: "Carlos Lezama, Marco Medina, Emiliano Ramírez y Santiago Villarreal"
date: "Jueves, 26 de agosto de 2021"
output:
    tufte::tufte_handout:
    citation_package: natbib
latex_engine: xelatex
bibliography: skeleton.bib
link-citations: yes
---

```{r setup, include=FALSE}
library(tufte)
library(tidyverse)
library(berryFunctions)
library(kableExtra)

knitr::opts_chunk$set(cache.extra = packageVersion('tufte'), cache = TRUE)
options(htmltools.dir.version = FALSE)
```

# Problema 1

Con el fin de comprobar la propiedad de falta de memoria de una distribución exponencial

```{marginfigure}
$$ P(X > t + s \mid X > t) = P(X > s) . $$
```

$$F(x;\lambda) = 
\begin{cases}
1-e^{-\lambda x} & x \ge 0, \\
0 & x < 0.
\end{cases}$$

definimos la  siguiente función:

```{r}
exponential_memoryless <- function(N, lambda) {
    t <- sample(1:10, N, replace = TRUE) # t
    s <- sample(1:10, N, replace = TRUE) # s
    
    # P(X > t + s | X > t)
    prob.1 <- (1 - pexp(t + s, lambda)) / (1 - pexp(t, lambda))
    
    # P(X > s)
    prob.2 <- 1 - pexp(s, lambda)
    
    return(tibble(prob.1, prob.2, almost.equal(prob.1, prob.2)))
}
```

que produce dos vectores aleatorios $t$ y $s$ de tamaño $N$ para calcular $P(X > t + s \mid X > t)$ y $P(X > s)$. Finalmente, devuelve una matriz con las probabilidades calculadas y corrobora que se cumpla la igualdad en cada una de las $N$ simulaciones con una columna lógica `TRUE` o `FALSE`.

Ahora bien, simulamos 100 y 1,000,000 de eventos, imprimiendo una matriz con probabilidades en las que no se cumple la igualdad.

```{r}
lambda <- 1 / 3 # Parámetro
r.1 <- exponential_memoryless(100, lambda) # 100 simulaciones
r.2 <- exponential_memoryless(1000000, lambda) # 1 000 000 simulaciones

r.1[r.1[, 3] == FALSE, ]
r.2[r.2[, 3] == FALSE, ]
```

Nótese que la igualdad se cumple en todos los casos, corroborando que:

\begin{align*}
P(X > t + s \mid X > t) &= \frac{P\left(X > t + s, X > t \right)}{P(X > t)}\\
                        &= \frac{P(X > t + s)}{P(X > t)}\\
                        &= \frac{1 - F_X(t + s)}{1 - F_X(t)}\\
                        &= \frac{e^{-\lambda (t + s)}}{e^{-\lambda t}}\\
                        &= e^{-\lambda s}\\
                        &= P(X > s) .
\end{align*}

# Problema 4

Simulamos la posible llegada de un cliente $Y \sim \text{Bernoulli}(0.9)$ tal que dicho cliente llega $(X \mid Y = 1) = 5 + u_1$, donde $u_1 \sim P(\text{llegada})$. Finalmente, para determinar el tiempo de salida $u_3$, necesitamos $u_2 \sim P(\text{tiempo de consulta})$ tal que $u_3 = u_1 + u_2$.

Así pues, para 50 pacientes:

```{r}
N <- 50 # número de pacientes
arrival <- duration <- numeric(N)

arrived <- rbinom(N, 1, 0.9) # qué pacientes llegaron
k <- length(which(arrived == 1)) # cuántos pacientes llegaron

arrival[which(arrived == 1)] <-
    5 + sample(-2:2,
               k,
               prob = c(0.1, 0.2, 0.4, 0.2, 0.1),
               replace = TRUE)
duration[which(arrived == 1)] <-
    sample(2:9,
           k,
           prob = c(0.1, 0.1, 0.1, 0.2, 0.2, 0.1, 0.1, 0.1),
           replace = TRUE)

arrival.time <- cumsum(arrival)

departure <- arrival.time + duration

# Clientes en espera cada 5 horas
queue.1 <- as.data.frame(table(cut(departure, breaks = seq(0, N * 5, by = 5))))
queue.2 <- as.data.frame(spline(queue.1$Var1, queue.1$Freq))
```

```{r fig.width = 10, fig.height = 3, fig.fullwidth = TRUE, cache=TRUE, echo=FALSE}
ggplot(queue.1, aes(x = Var1, y = Freq, group = 1)) +
    geom_point() +
    geom_line() +
    labs(title = 'Clientes en espera cada 5 horas',
         x = '',
         y = 'Clientes') +
    theme_minimal() +
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          axis.text.x=element_blank())
```

# Problema 7

Si dos dados están cargados de tal manera que en un dado, el valor 1 aparecerá exactamente el doble de veces que los otros valores, y el otro dato está igualmente cargado hacia el 6, calculen la probabilidad $p_{s}$ de que un total exactamente igual a $s$ aparecerá en la suma de los dados, para $2\leq s \leq 12$.

Sea $D_{1}$ el dado cargado al valor 1 y $D_{6}$ el dado cargado al valor 6. En cada dado $D_{i}$, la probabilidad de obtener el valor $i$ es el doble de la probabilidad de obtener cualquier otro valor. Sea $q$ la probabilidad de obtener el valor $i$ en el dado $D_{i}$, y $q/2$ la probabilidad de obtener cualquier otro valor, por lo que: 

$$\sum_{k=1}^{6}\mathbb{P}[D_{i} = k] =  q + \frac{q}{2} + \frac{q}{2} + \frac{q}{2} + \frac{q}{2} + \frac{q}{2} = 1 \implies \frac{7q}{2} = 1 \implies q = \frac{2}{7}$$

Entonces $\mathbb{P}[D_{i} = i] = \frac{2}{7}$ y $\mathbb{P}[D_{i} = j] = \frac{1}{7}$, para $i\neq j$. 

\

Sea $s$ la suma del valor de los dados $D_{1}$ y $D_{6}$. Suponiendo que $D_{1}$ y $D_{6}$ son independientes, entonces:

$\mathbb{P}[s = 2] = \mathbb{P}[D_{1} = 1, D_{6} = 1] = \frac{2}{7}\cdot\frac{1}{7} = \frac{2}{49}$

$\mathbb{P}[s = 3] = \mathbb{P}[D_{1} = 1, D_{6} = 2] + \mathbb{P}[D_{1} = 2, D_{6} = 1] = \frac{2}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7}= \frac{3}{49}$

$\mathbb{P}[s = 4] = \mathbb{P}[D_{1} = 1, D_{6} = 3] + \mathbb{P}[D_{1} = 2, D_{6} = 2] + \mathbb{P}[D_{1} = 3, D_{6} = 1] = \frac{2}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7}= \frac{4}{49}$

$\mathbb{P}[s = 5] = \mathbb{P}[D_{1} = 1, D_{6} = 4] + \mathbb{P}[D_{1} = 2, D_{6} = 3] + \mathbb{P}[D_{1} = 3, D_{6} = 2] + \mathbb{P}[D_{1} = 4, D_{6} = 1] = \frac{2}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} = \frac{5}{49}$

$\mathbb{P}[s = 6] = \mathbb{P}[D_{1} = 1, D_{6} = 5] + \mathbb{P}[D_{1} = 2, D_{6} = 4] + \mathbb{P}[D_{1} = 3, D_{6} = 3] + \mathbb{P}[D_{1} = 4, D_{6} = 2] + \mathbb{P}[D_{1} = 5, D_{6} = 1] = \frac{2}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} = \frac{6}{49}$

$\mathbb{P}[s = 7] = \mathbb{P}[D_{1} = 1, D_{6} = 6] + \mathbb{P}[D_{1} = 2, D_{6} = 5] + \mathbb{P}[D_{1} = 3, D_{6} = 4] + \mathbb{P}[D_{1} = 4, D_{6} = 3] + \mathbb{P}[D_{1} = 5, D_{6} = 2] + \mathbb{P}[D_{1} = 6, D_{6} = 1] = \frac{2}{7}\cdot\frac{2}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7}= \frac{9}{49}$

$\mathbb{P}[s = 8] = \mathbb{P}[D_{1} = 2, D_{6} = 6] + \mathbb{P}[D_{1} = 3, D_{6} = 5] + \mathbb{P}[D_{1} = 4, D_{6} = 4] + \mathbb{P}[D_{1} = 5, D_{6} = 3] + \mathbb{P}[D_{1} = 6, D_{6} = 2] =  \frac{1}{7}\cdot\frac{2}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} = \frac{6}{49}$

$\mathbb{P}[s = 9] = \mathbb{P}[D_{1} = 3, D_{6} = 6] + \mathbb{P}[D_{1} = 4, D_{6} = 5] + \mathbb{P}[D_{1} = 5, D_{6} = 4] + \mathbb{P}[D_{1} = 6, D_{6} = 3] = \frac{1}{7}\cdot\frac{2}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7} = \frac{5}{49}$

$\mathbb{P}[s = 10] = \mathbb{P}[D_{1} = 4, D_{6} = 6] + \mathbb{P}[D_{1} = 5, D_{6} = 5] + \mathbb{P}[D_{1} = 6, D_{6} = 4]  = \frac{1}{7}\cdot\frac{2}{7} + \frac{1}{7}\cdot\frac{1}{7} + \frac{1}{7}\cdot\frac{1}{7}= \frac{4}{49}$

$\mathbb{P}[s = 11] = \mathbb{P}[D_{1} = 5, D_{6} = 6] + \mathbb{P}[D_{1} = 6, D_{6} = 5] = \frac{1}{7}\cdot\frac{2}{7} + \frac{1}{7}\cdot\frac{1}{7}= \frac{3}{49}$

$\mathbb{P}[s = 12] = \mathbb{P}[D_{1} = 6, D_{6} = 6] =\frac{1}{7}\cdot\frac{2}{7} = \frac{2}{49}$

\

Entonces, las probabilidades para $2 \leq s \leq 12$:

```{r prob_sum_dices_table, echo = FALSE}
# Creamos vectores con cada valor de s y con las probabilidades de cada valor de s
s <- c(2:12)
p <- c("2/49","3/49","4/49","5/49","6/49","9/49","6/49","5/49","4/49","3/49","2/49")

# Creamos dataframe con las probabilidades de cada valor de s
probs <- data.frame(s, p)

# Trasponemos el dataframe
probs <- data.frame(t(probs))
rownames(probs) <- c("$s$", "$\\mathbb{P}$")

# Creamos tabla con las probabilidades
probs %>%
  kbl(align = "c", booktabs = T, format = "latex", escape = F,
      col.names = NULL) %>%
  kable_styling(latex_options = "striped")
```


```{r bib, include=FALSE}
knitr::write_bib(c('base', 'rmarkdown'), file = 'skeleton.bib')
```
